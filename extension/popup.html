<html>
<head>
<title>
ChromeQuest
</title>
<script language="JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
</script>
<body>
<div class="1">
<form name="Form">
<input type="button" value="Create Quest" onclick="createQuest();"><br>
<input name="hash" id="hash" value="">
<input type="button" value="Join" onclick="createGET('http://oni.dyndns.org:8080/player/join-quest?q=' + document.Form.hash.value + '&nick=ololo2');">
</form>
</div>
<div class="2" style="display:none">
<form name="Form2">
Description:<input name="descr"><br>
<input type="button" value="Add page" onclick="createPOST('http://oni.dyndns.org:8080/master/add-task' )"><br>
<input type="button" value="Open quest" onclick="createGET('http://oni.dyndns.org:8080/master/open-quest' );">
</form>
</div>
</body>
</html>
<script>  
	function createQuest() {
		createGET('http://oni.dyndns.org:8080/master/create-quest?master=ololo' , function(data) {
		  $("#hash").val(data.questhash);
		  });
	}
    function createGET(str, callback)
    {
    	/*var req = new XMLHttpRequest();
		req.open("GET",
			    str,
			    true);
		req.onreadystatechange = function (aEvt) {
		  if (req.readyState == 4) {
		     if(req.status == 200)
		     	console.log(JSON.parse(req.responseText).questhash);
		     else
		     	console.log('Error', req.statusText);
		  }
		};
		req.send(null);*/
		$.getJSON(str, function (data) {console.log(data);if (callback) callback(data)});
    }
    
    function createPOST(str)
    {
        chrome.tabs.getSelected(null, 
	    	function Send(tab) {
 		       $.post(str, {url : tab.url, descr : document.Form2.descr.value}, function callback(data) {console.log(data)});
 		  	}
 		);
	}  
</script>

